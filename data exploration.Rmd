---
title: "Data Exploration"
author: "Gage Clawson"
date: "2/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Load packages
library(tidyverse)
library(tidyr)
library(RColorBrewer)
library(janitor)
library(chron)
library(sf)



```


```{r}
#Load the data
oil_accidents_raw <- read_csv("database.csv")
```

```{r}
# Initial data cleanup and wrangling

oil_accidents <- oil_accidents_raw %>%
  clean_names() %>% #clean the names snake case
  select(report_number, accident_year:liquid_type, accident_city:cause_category, net_loss_barrels:restart_date_time, property_damage_costs:all_costs) %>% #select relevant columns
  separate(accident_date_time, c("day", "month", "year", "hour", "minute" ,"am_or_pm"), by = c("/", " ")) %>%  #separate the date time column
  unite("time", hour, minute, sep = ":") %>% #bring time back together
  unite("time", time, am_or_pm, sep = " ") %>% #bring time back together
  filter(accident_year != 2017) %>% #filter out the 2 2017 observations
  unite("date", year,month,day, sep = "-") %>% #make the date column again
  mutate(date = as.Date(date)) #change date to date standard internation date format 
  
# do we want to go through the offshore accidents and add states to them by looking at the coordinates? Looks like most of them are in louisana 

# report number 20140310 is in mongolia... should be wyoming
# report number 20140063 is in china... should be in texas
# report number 20150309 is near portugal... should be new jersey. 
# these are obvious incidents of inputting data incorrectly. Lets filter to lat and long ranges for the united states. I think all of the latitudes look fine 

oil_accidents_US <- oil_accidents %>%
  filter(accident_longitude < -60)
```


```{r}
sum_df <- oil_accidents %>%
  group_by(accident_year) %>%
  summarise(count_accidents = length(report_number))

## graph in shiny we will be able to select what state
ggplot(sum_df, aes(x = accident_year, y = count_accidents)) +
  geom_point() +
  geom_line()
```

```{r}

#http://eriqande.github.io/rep-res-web/lectures/making-maps-with-R.html 
#^link to information on how to make maps with r and how i figured this out

library(rworldmap)
library(mapdata)
library(maps)
library(ggmap)


usa <- map_data("usa")

w2hr <- map_data("world2Hires")

gg1 <- ggplot() +
  geom_polygon(data = usa, aes(x = long, y = lat, group = group), fill = "darkgreen", color = "red") +
  coord_fixed(1.3)  + 
  geom_point(data = oil_accidents_US, aes(x = accident_longitude, y= accident_latitude)) +
  theme_void()

gg1




## make a geometry column out of the lat long columns to possibly use sf like we did in lab to map. 
oil_geom <- st_as_sf(
  oil_accidents_US, 
  coords = c('accident_longitude', 'accident_latitude'),
  crs = "+init=epsg:28992"
)

oil_geom

ggplot(oil_geom) +
  geom_sf(aes(fill = all_costs))  ##kind of worked but not really 
```


